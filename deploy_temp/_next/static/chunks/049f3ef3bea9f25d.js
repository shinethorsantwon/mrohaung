(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75254,e=>{"use strict";var t=e.i(71645);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:i="",children:o,iconNode:c,...d},u)=>(0,t.createElement)("svg",{ref:u,...a,width:s,height:s,stroke:e,strokeWidth:n?24*Number(l)/Number(s):l,className:r("lucide",i),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(o)?o:[o]])),n=(e,a)=>{let n=(0,t.forwardRef)(({className:n,...i},o)=>(0,t.createElement)(l,{ref:o,iconNode:a,className:r(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i}));return n.displayName=s(e),n};e.s(["default",()=>n],75254)},88653,e=>{"use strict";e.i(47167);var t=e.i(43476),r=e.i(71645),s=e.i(31178),a=e.i(47414),l=e.i(74008),n=e.i(21476),i=e.i(72846),o=r,c=e.i(37806);function d(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class u extends o.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent&&!1!==this.props.pop){let e=t.offsetParent,r=(0,i.isHTMLElement)(e)&&e.offsetWidth||0,s=(0,i.isHTMLElement)(e)&&e.offsetHeight||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=r-a.width-a.left,a.bottom=s-a.height-a.top}return null}componentDidUpdate(){}render(){return this.props.children}}function m({children:e,isPresent:s,anchorX:a,anchorY:l,root:n,pop:i}){let m=(0,o.useId)(),f=(0,o.useRef)(null),h=(0,o.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:x}=(0,o.useContext)(c.MotionConfigContext),p=function(...e){return r.useCallback(function(...e){return t=>{let r=!1,s=e.map(e=>{let s=d(e,t);return r||"function"!=typeof s||(r=!0),s});if(r)return()=>{for(let t=0;t<s.length;t++){let r=s[t];"function"==typeof r?r():d(e[t],null)}}}}(...e),e)}(f,e.props?.ref??e?.ref);return(0,o.useInsertionEffect)(()=>{let{width:e,height:t,top:r,left:o,right:c,bottom:d}=h.current;if(s||!1===i||!f.current||!e||!t)return;let u="left"===a?`left: ${o}`:`right: ${c}`,p="bottom"===l?`bottom: ${d}`:`top: ${r}`;f.current.dataset.motionPopId=m;let b=document.createElement("style");x&&(b.nonce=x);let g=n??document.head;return g.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            ${u}px !important;
            ${p}px !important;
          }
        `),()=>{g.contains(b)&&g.removeChild(b)}},[s]),(0,t.jsx)(u,{isPresent:s,childRef:f,sizeRef:h,pop:i,children:!1===i?e:o.cloneElement(e,{ref:p})})}let f=({children:e,initial:s,isPresent:l,onExitComplete:i,custom:o,presenceAffectsLayout:c,mode:d,anchorX:u,anchorY:f,root:x})=>{let p=(0,a.useConstant)(h),b=(0,r.useId)(),g=!0,j=(0,r.useMemo)(()=>(g=!1,{id:b,initial:s,isPresent:l,custom:o,onExitComplete:e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;i&&i()},register:e=>(p.set(e,!1),()=>p.delete(e))}),[l,p,i]);return c&&g&&(j={...j}),(0,r.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[l]),r.useEffect(()=>{l||p.size||!i||i()},[l]),e=(0,t.jsx)(m,{pop:"popLayout"===d,isPresent:l,anchorX:u,anchorY:f,root:x,children:e}),(0,t.jsx)(n.PresenceContext.Provider,{value:j,children:e})};function h(){return new Map}var x=e.i(64978);let p=e=>e.key||"";function b(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}let g=({children:e,custom:n,initial:i=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:u=!1,anchorX:m="left",anchorY:h="top",root:g})=>{let[j,y]=(0,x.usePresence)(u),v=(0,r.useMemo)(()=>b(e),[e]),w=u&&!j?[]:v.map(p),N=(0,r.useRef)(!0),k=(0,r.useRef)(v),C=(0,a.useConstant)(()=>new Map),S=(0,r.useRef)(new Set),[M,$]=(0,r.useState)(v),[P,E]=(0,r.useState)(v);(0,l.useIsomorphicLayoutEffect)(()=>{N.current=!1,k.current=v;for(let e=0;e<P.length;e++){let t=p(P[e]);w.includes(t)?(C.delete(t),S.current.delete(t)):!0!==C.get(t)&&C.set(t,!1)}},[P,w.length,w.join("-")]);let I=[];if(v!==M){let e=[...v];for(let t=0;t<P.length;t++){let r=P[t],s=p(r);w.includes(s)||(e.splice(t,0,r),I.push(r))}return"wait"===d&&I.length&&(e=I),E(b(e)),$(v),null}let{forceRender:L}=(0,r.useContext)(s.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:P.map(e=>{let r=p(e),s=(!u||!!j)&&(v===P||w.includes(r));return(0,t.jsx)(f,{isPresent:s,initial:(!N.current||!!i)&&void 0,custom:n,presenceAffectsLayout:c,mode:d,root:g,onExitComplete:s?void 0:()=>{if(S.current.has(r)||(S.current.add(r),!C.has(r)))return;C.set(r,!0);let e=!0;C.forEach(t=>{t||(e=!1)}),e&&(L?.(),E(k.current),u&&y?.(),o&&o())},anchorX:m,anchorY:h,children:e},r)})})};e.s(["AnimatePresence",()=>g],88653)},14764,e=>{"use strict";let t=(0,e.i(75254).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],14764)},73708,e=>{"use strict";let t=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>t],73708)},97960,e=>{"use strict";let t=(0,e.i(75254).default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);e.s(["Smile",()=>t],97960)},23585,e=>{"use strict";let t=(0,e.i(75254).default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["MoreVertical",()=>t],23585)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},67585,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let s=e.r(32061);function a({reason:e,children:t}){if("u"<typeof window)throw Object.defineProperty(new s.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,r)=>{"use strict";function s(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"encodeURIPath",{enumerable:!0,get:function(){return s}})},52157,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"PreloadChunks",{enumerable:!0,get:function(){return o}});let s=e.r(43476),a=e.r(74080),l=e.r(63599),n=e.r(9885),i=e.r(43369);function o({moduleIds:e}){if("u">typeof window)return null;let t=l.workAsyncStorage.getStore();if(void 0===t)return null;let r=[];if(t.reactLoadableManifest&&e){let s=t.reactLoadableManifest;for(let t of e){if(!s[t])continue;let e=s[t].files;r.push(...e)}}if(0===r.length)return null;let o=(0,i.getDeploymentIdQueryOrEmptyString)();return(0,s.jsx)(s.Fragment,{children:r.map(e=>{let r=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}${o}`;return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:r,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,a.preload)(r,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return c}});let s=e.r(43476),a=e.r(71645),l=e.r(67585),n=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},c=function(e){let t={...o,...e},r=(0,a.lazy)(()=>t.loader().then(i)),c=t.loading;function d(e){let i=c?(0,s.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,d=o?a.Suspense:a.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:["u"<typeof window?(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(r,{...e})]}):(0,s.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(d,{...o?{fallback:i}:{},children:u})}return d.displayName="LoadableComponent",d}},70703,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return a}});let s=e.r(55682)._(e.r(69093));function a(e,t){let r={};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,s.default)({...a,modules:a.loadableGenerated?.modules})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},79877,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(24892),l=e.i(85384),n=e.i(46932),i=e.i(88653),o=e.i(55436);function c({conversations:e,selectedId:s,onSelect:a,currentUserId:l}){let[i,c]=(0,r.useState)(""),d=e.filter(e=>{let t=e.participants[0];return(t.displayName||t.username||"").toLowerCase().includes(i.toLowerCase())||(t.username||"").toLowerCase().includes(i.toLowerCase())});return(0,t.jsxs)("div",{className:"flex flex-col h-full bg-[#0f172a]/40 backdrop-blur-xl border-r border-[#1e293b]",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-[#1e293b]",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-white mb-4",children:"Messages"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#64748b]"}),(0,t.jsx)("input",{type:"text",placeholder:"Search chats...",value:i,onChange:e=>c(e.target.value),className:"w-full bg-[#1e293b]/50 border border-[#334155] rounded-xl pl-10 pr-4 py-2 text-sm text-white placeholder-[#64748b] focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all"})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:0===d.length?(0,t.jsx)("div",{className:"p-8 text-center text-[#64748b]",children:i?"No results found":"No conversations yet"}):d.map(e=>{let r=e.participants[0],l=s===e.id;return(0,t.jsxs)(n.motion.div,{whileHover:{backgroundColor:"rgba(30, 41, 59, 0.4)"},whileTap:{scale:.98},onClick:()=>a(e),className:`mx-2 my-1 p-3 rounded-2xl cursor-pointer transition-all relative group ${l?"bg-blue-600/20 shadow-lg shadow-blue-500/10":"hover:bg-[#1e293b]/30"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full bg-[#1e293b] bg-cover bg-center border-2 transition-all ${l?"border-blue-500 shadow-lg shadow-blue-500/20":"border-[#334155]/50 group-hover:border-[#475569]"}`,style:{backgroundImage:r.avatarUrl?`url(${r.avatarUrl})`:void 0}}),(0,t.jsx)("div",{className:"absolute bottom-0.5 right-0.5 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-[#0f172a]"})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[(0,t.jsx)("h3",{className:`font-bold text-sm truncate ${l?"text-white":"text-[#f1f5f9]"}`,children:r.displayName||r.username}),e.lastMessageAt&&(0,t.jsx)("span",{className:`text-[10px] ${l?"text-blue-300":"text-[#64748b]"}`,children:(e=>{if(!e)return"";let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/36e5);return r<24?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):r<48?"Yesterday":t.toLocaleDateString("en-US",{month:"short",day:"numeric"})})(e.lastMessageAt)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:`text-xs truncate flex-1 ${e.unreadCount>0?"text-blue-100 font-bold":"text-[#94a3b8]"}`,children:""===e.id?"Start a new conversation":e.lastMessage?.content||"Started a conversation"}),e.unreadCount>0&&(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white text-[10px] font-black rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg shadow-blue-500/30",children:e.unreadCount})]})]})]}),l&&(0,t.jsx)(n.motion.div,{layoutId:"active-indicator",className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-blue-500 rounded-r-full"})]},e.id)})})]})}var d=e.i(14764),u=e.i(23585),m=e.i(73708),f=e.i(97960),h=e.i(37727);let x=(0,e.i(75254).default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var p=e.i(87316),b=e.i(94983);function g({message:e,currentUserId:r,formatTime:s}){let a=e.senderId===r;return(0,t.jsxs)("div",{className:`flex flex-col ${a?"items-end":"items-start"} mb-1.5 px-2 relative w-full`,children:[(0,t.jsx)("div",{className:`h-3 flex items-end ${a?"justify-end pr-8":"justify-start pl-8"} w-full mb-0.5`,children:(0,t.jsx)("span",{className:"text-[7.5px] font-bold uppercase tracking-tight text-white/20 select-none",children:s(e.createdAt)})}),(0,t.jsxs)("div",{className:"flex items-end gap-1.5 flex-row max-w-full",children:[!a&&(0,t.jsx)("div",{className:"relative flex-shrink-0 mb-0.5",children:(0,t.jsx)("div",{className:"w-7 h-7 rounded-full overflow-hidden border border-white/10 ring-2 ring-white/5 shadow-md bg-[#1e293b]",children:e.sender?.avatarUrl?(0,t.jsx)("img",{src:e.sender.avatarUrl,alt:"",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[10px] font-black text-white/40",children:(e.sender?.displayName||e.sender?.username)?.[0]?.toUpperCase()||"?"})})}),(0,t.jsxs)("div",{className:`relative px-3.5 py-1.5 shadow-lg border ${a?"bg-[#007aff] text-white border-blue-400/20 rounded-[18px] rounded-tr-[4px]":"bg-[#2a354a] text-[#e4e6eb] border-white/5 rounded-[18px] rounded-tl-[4px]"} max-w-[200px] sm:max-w-[240px]`,children:[e.replyToContent&&(0,t.jsx)("div",{className:"px-2 py-0.5 mb-1 bg-black/10 text-[9px] italic opacity-40 rounded border-l-2 border-white/20 truncate",children:e.replyToContent}),(0,t.jsx)("p",{className:"text-[13px] leading-[1.4] break-words whitespace-pre-wrap font-medium tracking-tight",children:e.content})]}),a&&(0,t.jsxs)("div",{className:"relative flex-shrink-0 mb-0.5 flex flex-col items-center gap-0.5",children:[(0,t.jsx)("div",{className:"h-1.5 flex items-center opacity-30",children:(0,t.jsx)("span",{className:"text-[7.5px] font-black tracking-tighter text-blue-400",children:e.read?"✓✓":"✓"})}),(0,t.jsx)("div",{className:"w-7 h-7 rounded-full overflow-hidden border border-blue-500/30 ring-2 ring-blue-500/10 shadow-md bg-blue-600/10",children:e.sender?.avatarUrl?(0,t.jsx)("img",{src:e.sender.avatarUrl,alt:"",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[10px] font-black text-blue-400",children:(e.sender?.displayName||e.sender?.username)?.[0]?.toUpperCase()||"Y"})})]})]}),e.reactions&&Object.keys(e.reactions).length>0&&(0,t.jsx)("div",{className:`flex flex-wrap gap-1 mt-1 ${a?"mr-8":"ml-8"}`,children:Object.entries(e.reactions).map(([e,r])=>(0,t.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-full px-1.5 py-0.5 text-[8px] flex items-center gap-1",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("span",{className:"font-bold text-blue-400",children:r.length})]},e))})]})}var j=e.i(70703),y=e.i(50144);let v=(0,j.default)(()=>e.A(61258),{loadableGenerated:{modules:[98888]},ssr:!1});function w({recipient:e,messages:s,currentUserId:a,messageInput:l,setMessageInput:c,onSendMessage:j,typingUser:w,onReact:N}){let k,C=(0,r.useRef)(null),S=(0,r.useRef)(null),[M,$]=(0,r.useState)(null),[P,E]=(0,r.useState)(null),[I,L]=(0,r.useState)(!1),[U,_]=(0,r.useState)(!1),[R,O]=(0,r.useState)(null),[T,A]=(0,r.useState)([]),D=(0,r.useRef)(null);(0,r.useEffect)(()=>{U&&z()},[U,e.id]);let z=async()=>{try{let e=await fetch(`${y.API_URL}/messages/conversations/${s[0]?.conversationId}/media`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=await e.json();A(t)}catch(e){console.error("Error fetching media:",e)}};(0,r.useEffect)(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[s,w]),(0,r.useEffect)(()=>{let e=e=>{D.current&&!D.current.contains(e.target)&&L(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let B=()=>{$(null),P&&(URL.revokeObjectURL(P),E(null)),S.current&&(S.current.value="")},W=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),F=(k={},s.forEach(e=>{let t=new Date(e.createdAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});k[t]||(k[t]=[]),k[t].push(e)}),k);return(0,t.jsxs)("div",{className:"flex flex-col h-full bg-[#0f172a]/20 backdrop-blur-xl relative overflow-hidden",children:[(0,t.jsxs)("header",{className:"p-4 border-b border-[#1e293b] flex items-center justify-between bg-[#0f172a]/60 backdrop-blur-md z-10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-[#334155] bg-cover bg-center border border-[#334155]",style:{backgroundImage:e.avatarUrl?`url(${e.avatarUrl})`:void 0}}),(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-[#1e293b]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-bold text-white leading-tight",children:e.displayName||e.username}),(0,t.jsx)("div",{className:"flex items-center gap-1.5 min-h-[1rem]",children:w?(0,t.jsx)("span",{className:"text-[10px] text-blue-400 font-medium animate-pulse italic",children:"typing..."}):(0,t.jsx)("span",{className:"text-[10px] text-green-500 font-medium tracking-wide uppercase",children:"Online"})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{className:"p-2 hover:bg-white/5 rounded-full transition-colors text-[#64748b]",children:(0,t.jsx)(o.Search,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:()=>_(!U),className:`p-2 rounded-full transition-colors ${U?"bg-blue-600/20 text-blue-400":"text-[#64748b] hover:bg-white/5"}`,children:(0,t.jsx)(x,{className:"w-5 h-5"})}),(0,t.jsx)("button",{className:"p-2 hover:bg-white/5 rounded-full transition-colors",children:(0,t.jsx)(u.MoreVertical,{className:"w-5 h-5 text-[#64748b]"})})]})]}),(0,t.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,t.jsxs)("div",{ref:C,className:"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar pattern-dots",children:[0===s.length?(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center opacity-30 select-none",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-[#1e293b] flex items-center justify-center mb-4",children:(0,t.jsx)(b.MessageCircle,{className:"w-10 h-10 text-white"})}),(0,t.jsx)("p",{className:"text-[#64748b] text-sm",children:"No messages yet. Start a conversation!"})]}):Object.entries(F).map(([e,r])=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex justify-center my-6",children:(0,t.jsxs)("div",{className:"bg-[#1e293b]/50 backdrop-blur-md border border-[#334155]/30 px-4 py-1 rounded-full text-[11px] font-bold text-[#64748b] uppercase tracking-widest flex items-center gap-2",children:[(0,t.jsx)(p.Calendar,{className:"w-3 h-3"}),e===new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})?"Today":e]})}),r.map(e=>(0,t.jsx)(g,{message:e,currentUserId:a,formatTime:W},e.id))]},e)),w&&(0,t.jsx)(n.motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex justify-start",children:(0,t.jsxs)("div",{className:"bg-[#1e293b]/40 px-3 py-1.5 rounded-full flex gap-1 items-center",children:[(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce"})]})})]}),(0,t.jsxs)("footer",{className:"p-4 bg-[#0f172a]/80 backdrop-blur-xl border-t border-[#1e293b] relative",children:[R&&(0,t.jsxs)(n.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mb-2 bg-[#1e293b]/80 border-l-4 border-blue-500 p-3 rounded-r-xl flex items-center justify-between group",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("p",{className:"text-xs font-bold text-blue-400",children:["Replying to ",R.senderId===a?"yourself":R.sender?.displayName||R.sender?.username]}),(0,t.jsx)("p",{className:"text-xs text-[#94a3b8] truncate mt-0.5",children:R.content})]}),(0,t.jsx)("button",{onClick:()=>O(null),className:"p-1 hover:bg-white/10 rounded-full text-[#64748b] hover:text-white",children:(0,t.jsx)(h.X,{className:"w-4 h-4"})})]}),I&&(0,t.jsx)("div",{ref:D,className:"absolute bottom-full left-4 mb-2 z-20 shadow-2xl",children:(0,t.jsx)(v,{onEmojiClick:e=>{c(t=>t+e.emoji)},theme:"dark",autoFocusSearch:!1})}),(0,t.jsx)(i.AnimatePresence,{children:P&&(0,t.jsxs)(n.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-4 relative inline-block group",children:[(0,t.jsx)("img",{src:P,alt:"Preview",className:"h-32 rounded-xl border border-[#334155] shadow-lg"}),(0,t.jsx)("button",{onClick:B,className:"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(h.X,{className:"w-3 h-3"})})]})}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(l.trim()||M)&&(j(l,M,R?.id,R?.content),O(null),B(),L(!1))},className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"file",ref:S,onChange:e=>{let t=e.target.files?.[0];t&&($(t),E(URL.createObjectURL(t)))},accept:"image/*",className:"hidden"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>S.current?.click(),className:"p-2 hover:bg-white/5 rounded-full transition-colors text-[#64748b] hover:text-white",children:(0,t.jsx)(m.Image,{className:"w-5 h-5"})}),(0,t.jsx)("button",{type:"button",onClick:()=>L(!I),className:`p-2 rounded-full transition-colors ${I?"bg-blue-600/20 text-blue-400":"text-[#64748b] hover:bg-white/5 hover:text-white"}`,children:(0,t.jsx)(f.Smile,{className:"w-5 h-5"})})]}),(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Type a message...",className:"w-full bg-[#1e293b]/50 text-white px-5 py-3 rounded-2xl border border-[#334155] focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder-[#475569]"})}),(0,t.jsx)("button",{type:"submit",disabled:!l.trim()&&!M,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 disabled:from-[#1e293b] disabled:to-[#1e293b] disabled:opacity-50 text-white p-3 rounded-2xl transition-all shadow-lg shadow-blue-500/20 active:scale-95 flex items-center justify-center group",children:(0,t.jsx)(d.Send,{className:`w-5 h-5 transition-transform ${l.trim()||M?"group-hover:translate-x-1 group-hover:-translate-y-1":""}`})})]})]})]}),(0,t.jsx)(i.AnimatePresence,{children:U&&(0,t.jsx)(n.motion.aside,{initial:{width:0,opacity:0},animate:{width:320,opacity:1},exit:{width:0,opacity:0},className:"bg-[#0f172a]/60 backdrop-blur-2xl border-l border-[#1e293b] overflow-hidden flex flex-col",children:(0,t.jsxs)("div",{className:"p-6 flex flex-col items-center text-center",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-[#1e293b] bg-cover bg-center border-4 border-blue-500/20 shadow-2xl mb-4",style:{backgroundImage:e.avatarUrl?`url(${e.avatarUrl})`:void 0}}),(0,t.jsx)("h3",{className:"text-xl font-bold text-white",children:e.displayName||e.username}),(0,t.jsx)("p",{className:"text-sm text-green-500 mb-6 font-medium",children:"Active Now"}),(0,t.jsx)("div",{className:"w-full space-y-4",children:(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("h4",{className:"text-xs font-bold text-[#64748b] uppercase tracking-wider mb-4",children:"Shared Media"}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:T.length>0?T.map(e=>(0,t.jsx)("div",{className:"aspect-square rounded-lg bg-[#1e293b] overflow-hidden group cursor-pointer border border-[#334155]/50 hover:border-blue-500/50 transition-all",children:(0,t.jsx)("img",{src:e.imageUrl,alt:"Shared",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"})},e.id)):(0,t.jsxs)("div",{className:"col-span-3 py-8 flex flex-col items-center opacity-30",children:[(0,t.jsx)(m.Image,{className:"w-8 h-8 mb-2"}),(0,t.jsx)("p",{className:"text-xs",children:"No media shared"})]})})]})})]})})})]})]})}function N(){(0,s.useRouter)();let e=(0,s.useSearchParams)().get("userId"),{socket:o}=(0,a.useSocket)(),[d,u]=(0,r.useState)([]),[m,f]=(0,r.useState)(null),[h,x]=(0,r.useState)([]),[p,b]=(0,r.useState)(""),[g,j]=(0,r.useState)(null),[y,v]=(0,r.useState)(""),[N,k]=(0,r.useState)(!0),C=(0,r.useCallback)(async()=>{try{let t=(await l.default.get("/messages/conversations")).data;if(u(t),k(!1),e){let r=t.find(t=>t.participants.some(t=>t.id===e));if(r)$(r);else try{let t=(await l.default.get(`/profile/${e}`)).data;f({id:"",participants:[t],lastMessage:null,lastMessageAt:null,unreadCount:0}),x([])}catch(e){console.error("Error fetching target user for deep link:",e)}}}catch(e){console.error("Error fetching conversations:",e),k(!1)}},[]),S=(0,r.useCallback)(async e=>{try{await l.default.put(`/messages/conversations/${e}/read`),u(t=>t.map(t=>t.id===e?{...t,unreadCount:0}:t))}catch(e){console.error("Error marking as read:",e)}},[]),M=(0,r.useCallback)(async e=>{try{let t=await l.default.get(`/messages/conversations/${e}/messages`);x(t.data),await S(e)}catch(e){console.error("Error fetching messages:",e)}},[S]);(0,r.useEffect)(()=>{let e=localStorage.getItem("token");e&&v(JSON.parse(atob(e.split(".")[1])).userId),C()},[C]),(0,r.useEffect)(()=>{if(o)return o.on("new_message",({conversationId:e,message:t})=>{m?.id===e&&(x(e=>[...e,t]),S(e)),C()}),o.on("user_typing",({userId:e,displayName:t,username:r,conversationId:s})=>{m?.id===s&&e!==y&&j(t||r)}),o.on("user_stop_typing",({conversationId:e})=>{m?.id===e&&j(null)}),o.on("messages_read",({conversationId:e})=>{m?.id===e&&x(e=>e.map(e=>({...e,read:!0})))}),o.on("message_reaction",({messageId:e,reactions:t})=>{x(r=>r.map(r=>r.id===e?{...r,reactions:t}:r))}),()=>{o.off("new_message"),o.off("user_typing"),o.off("user_stop_typing"),o.off("messages_read")}},[o,m,y,S,C]);let $=e=>{f(e),M(e.id),o&&o.emit("join_conversation",e.id)},P=async(e,t,r,s)=>{if(!e.trim()&&!t||!m)return;let a=new FormData;a.append("conversationId",m.id),e.trim()&&a.append("content",e.trim()),t&&a.append("image",t),r&&a.append("replyToId",r),s&&a.append("replyToContent",s);try{let e=await l.default.post("/messages/send",a,{headers:{"Content-Type":"multipart/form-data"}});x(t=>[...t,e.data]),o&&o.emit("stop_typing",{conversationId:m.id})}catch(e){console.error("Error sending message:",e)}},E=async(e,t)=>{try{await l.default.post(`/messages/${e}/reaction`,{emoji:t})}catch(e){console.error("Error handling reaction:",e)}};return N?(0,t.jsx)("div",{className:"min-h-screen bg-[#0f172a] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"text-blue-400 font-medium animate-pulse",children:"Loading messages..."})]})}):(0,t.jsxs)("div",{className:"h-screen bg-[#0f172a] flex overflow-hidden",children:[(0,t.jsx)("div",{className:`${m?"hidden md:block":"block"} w-full md:w-[350px] lg:w-[400px] h-full`,children:(0,t.jsx)(c,{conversations:d,selectedId:m?.id,onSelect:$,currentUserId:y})}),(0,t.jsx)("main",{className:`${m?"block":"hidden md:flex"} flex-1 h-full`,children:(0,t.jsx)(i.AnimatePresence,{mode:"wait",children:m?(0,t.jsx)(n.motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"w-full h-full",children:(0,t.jsx)(w,{recipient:m.participants[0],messages:h,currentUserId:y,messageInput:p,setMessageInput:e=>{b(e),(()=>{if(o&&m&&localStorage.getItem("token")){let e=JSON.parse(localStorage.getItem("user")||"{}");o.emit("typing",{conversationId:m.id,username:e.username,displayName:e.displayName})}})()},onSendMessage:P,typingUser:g,onReact:E})},m.id):(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center bg-[#0f172a]/40 backdrop-blur-xl",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-blue-600/20 to-purple-600/20 flex items-center justify-center mb-6",children:(0,t.jsx)(n.motion.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:4,repeat:1/0},children:(0,t.jsx)("svg",{className:"w-12 h-12 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.827-1.213L3 21l1.657-4.582A13.854 13.854 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Your Messages"}),(0,t.jsx)("p",{className:"text-[#64748b] max-w-sm",children:"Send a message to start a conversation with your friends."})]})})})]})}function k(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-[#0f172a] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("p",{className:"text-blue-400 font-medium animate-pulse",children:"Initializing messages..."})]})}),children:(0,t.jsx)(N,{})})}e.s(["default",()=>k],79877)},61258,e=>{e.v(t=>Promise.all(["static/chunks/7d3ffdfe182837a2.js"].map(t=>e.l(t))).then(()=>t(98888)))}]);